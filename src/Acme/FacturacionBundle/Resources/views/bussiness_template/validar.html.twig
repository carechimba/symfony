{% extends 'AcmeFacturacionBundle:bussiness_template:_layout.html.twig' %}
{% block header %}
	<style type="text/css">
		.valid{
			color:green;
		}
		.invalid{
			
			color:red;
		}
		
		/*   */
		.custom_file_input .customfile{
			float:left;
			margin:2px;
		}
	</style>
	<!--=========	MENSAJES DE SESSION	============	-->
	
	
		<script type="text/javascript" src="http://filamentgroup.github.com/EnhanceJS/enhance.js"></script>		
		<script type="text/javascript">
			// Run capabilities test
			enhance({
				loadScripts: [
					'https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js',
					'/bussiness/fileInput/js/jQuery.fileinput.js',
					'/bussiness/fileInput/js/example.js'
				],
				loadStyles: ['/bussiness/fileInput/css/enhanced.css']	
			});   
		</script>
	
	<!--========= FIN DE MENSAJES DE SESSION ==========	-->
	<div>
		
		<div class="text1"></div>				
		<div class="text2">Validar comprobante digital</div>					
		<br>
		
		<form name="myform" action="{{ path('AcmeFacturacionBundle_validar')}}" method="POST" enctype="multipart/form-data" style="float:left;margin-left:245px;">
		<!---->
			<fieldset class="custom_file_input">
				<legend>Seleccione el comprobante digital</legend>				
				<input type="file" name="comprobante" id="file" />
				<!--<input type="submit" name="upload" id="upload" value="Upload photo" /> -->
			<!---->
			<!--<div class="fileinputs" style="width:200px;float:left;">
				
				<input name="comprobante2" type="file" class="file" />
				<div class="fakefile">
					<input />			
					<img src="{{ asset('/bussiness/images/file-explorer.png') }}" style="margin-top:-4px;" />
				</div>
			</div>	-->	
			
			<div style="width:100px;float:left;">
			<a href="javascript: submitform()" class="button" style="height:65px;margin-left:0px;" ><span><span>Validar</span></span></a>
			</fieldset>
			</div>
			<br>				
		</form>
		
		{% if respuesta is defined %}
			{% if respuesta['success'] %}
				{% set mensaje = "El comprobante es valido" %}
				{% set estilo = "float:left;" %}
			{%  endif %}
			
			{% if respuesta['success']==false %}
				{% set mensaje = "El comprobante es invalido" %}
				{% set estilo = "float:left;color:red;" %}
			{%  endif %}
		
		
			<div class="flash-notice" style="{{ estilo }}">
				{{ mensaje }}
			</div>
		{%  endif %}
		
		
		
	</div>
	
	<script type="text/javascript">
		function submitform(){
		  document.myform.submit();
		}
	</script>
	
	{% if errores is defined %}
		<div style="clear:both;margin-top:-10px;margin-left:105px;">
			<h1 style="margin-left:-142px;">Lista de errores</h1><br>
		{% for error in errores %}			 			 
			 {{ error.message	 }}<br>
			 <br>
		{% endfor %}
		</div>
	{% endif %}
	
	{% if respuesta is defined %}		
		{% if respuesta['validaciones']['xml']['success'] %}
			
			{% set valXml="OK" %}
			{% set cssXML="valid" %}
		{% else %}
			
			{% set valXml="INVALID" %}
			{% set cssXML="invalid" %}
		{% endif %}
		
		{% if respuesta['validaciones']['certificado_validez'] %}
			{% set valSello="VALIDO" %}
			{% set cssSello="valid" %}
		{% else %}
			
			{% set valSello="INVALIDO" %}
			{% set cssSello="invalid" %}
		
		{% endif %}
		
		<div style="clear:both;margin-top:-10px;margin-left:105px;">
			<h1 style="margin-left:-75px;">Verificaciones:</h1><br/>
			<label>Estructura del XML versi&oacute;n {{ respuesta['validaciones']['xml']['version'] }}</label><label style="margin-left:10px;" class="{{ cssXML }}">{{ valXml }}</label>
			<br/>
			<br/>
			{% if respuesta['validaciones']['xml']['success']==false %}
				<div>Detalle de los errores:</div>
				{% for error in respuesta['validaciones']['xml']['errores'] %}
					<br/>
					<label>Linea:</label> <div style="display:inline;">{{ error.line }},</div><label style='margin-left:10px;'>Columna:</label> <div style="display:inline;">{{ error.column }}.</div><br/>
					{{ error.message }}		
					
				{% endfor %}
			{% endif  %}
			<br><br>
			<label>Sello digital:</label><label style="margin-left:10px;" class="{{ cssSello }}">{{ valSello }}</label>
			<br/>
			<label>Cadena original generada:</label><br/>
			<label style="" >{{ respuesta['validaciones']['cadena_original'] }}</label>
			<br/><br/>
			
			<br/>
			<label>C&aacute;lculo del total:</label><label style="margin-left:10px;" class="sin_validar">Sin Validar</label><br/>
			<label style="" >Operacion realizada</label><label style="margin-left:10px;" >Total = Subtotal - descuento + impuestos</label>
			<br>
			<label style="" >Operacion realizada</label><label style="margin-left:10px;" >500.00 = 500.00 - 100.00 + 120.00</label>
			<br/>
			<br/>
			<label>C&aacute;lculo de Impuestos:</label><label style="margin-left:10px;" class="sin_validar">Sin Validar</label><br/>
			<label style="" >Operacion realizada</label><label style="margin-left:10px;" >¿¿??</label>
			<br/>
			<br/>
			<label>C&aacute;lculo del subtotal:</label><label style="margin-left:10px;" class="sin_validar">Sin Validar</label><br/>
			<label style="" >Operacion realizada:</label><label style="margin-left:10px;" >¿¿??</label>
			
			
		</div>
		<div style="clear:both;"></div>
		<object type="application/pdf"  width="100%" style="margin-top:20px;" height="400" data="/tmp/AAA010101AAA_A_362_120217.pdf">
				 alt : <a href="goodies/pdfs/indice_contenido.pdf"></a> 			
		</object> 		
	{% endif %}
	
	
{% endblock %}

{% block modulos %}
{% endblock %}

{% block noticia %}
	{% autoescape true %}
	<h2>Facturacion Expresso</h2>
	<a href="#">Contribuir</a><br/>
	<div>
		Y que pas&oacute; con los acentos.
	</div>
	{% endautoescape %}
{% endblock %}